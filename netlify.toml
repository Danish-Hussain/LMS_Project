# Explicit Netlify configuration so the platform uses our build script.
# Goal: avoid Turbopack server chunk mismatches by building with webpack and
# publishing the Next output. The Netlify Next Runtime will detect Next.js and
# bundle functions accordingly.

[build]
  # Run prisma generate first so the Prisma Client is available, then run
  # migrations and finally run the Next.js build. Ensure `DATABASE_URL` is
  # set in Netlify's Environment variables (pointing to your Postgres DB).
  # Example DATABASE_URL: postgres://user:password@host:5432/dbname
  command = "npx prisma generate && npx prisma migrate deploy && npm run build"
  publish = ".next"

[build.environment]
  NEXT_TELEMETRY_DISABLED = "1"
  # Force webpack by not using Turbopack flags (handled in package.json)
  # You can add other envs here if needed (e.g., DATABASE_URL in Netlify UI)
