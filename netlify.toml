# Explicit Netlify configuration so the platform uses our build script.
# Goal: avoid Turbopack server chunk mismatches by building with webpack and
# publishing the Next output. The Netlify Next Runtime will detect Next.js and
# bundle functions accordingly.

[build]
  # Use a dedicated npm script so the build command is reproducible and
  # readable in Netlify's UI. This script will generate the Prisma client,
  # deploy migrations, then run the stable Next.js build (webpack).
  command = "npm run build:netlify:ci"
  publish = ".next"

[build.environment]
  NEXT_TELEMETRY_DISABLED = "1"
  # Ensure Turbopack is disabled during Netlify builds (extra safety).
  NEXT_DISABLE_TURBOPACK = "1"
  # Force webpack by not using Turbopack flags (handled in package.json)
  # You can add other envs here if needed (e.g., DATABASE_URL in Netlify UI)
